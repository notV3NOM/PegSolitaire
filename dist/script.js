(()=>{"use strict";class e{constructor(){this.board=document.getElementById("boardContainerID"),this.textContainer=document.getElementById("textContainerID"),this.nMoves=0,this.lifeTime=1e3,this.sleepTime=100,this.nExperiments=1,this.avgMoves=0,this.avgPegsRemaining=0,this.boardState="",this.boardHistory=[e.defaultStartingState],this.sourcePeg=[-1,-1],this.userMoves=0,e.InitializeBoard(),this.textContainer.textContent="\n  Welcome to Peg Solitaire ! \n\n  Click on the buttons below to start\n"}static get defaultStartingState(){return"111111111111111101111111111111111"}static get finalState(){return"000000000000000010000000000000000"}static get boardSize(){return 7}static InitializeBoard=()=>{for(let t=0;t<e.boardSize;++t){const n=document.createElement("div");n.setAttribute("id","rowID"),n.className="row";for(let s=0;s<e.boardSize;++s){const e=document.createElement("div");e.setAttribute("id",""+t+s),e.className="cell",n.appendChild(e)}document.getElementById("boardContainerID").appendChild(n)}for(let n=0;n<e.boardSize;++n)for(let s=0;s<e.boardSize;++s)if(n!=Math.floor(e.boardSize/2)||s!=Math.floor(e.boardSize/2)){var t=document.createElement("span");t.className="peg",document.getElementById(""+n+s).appendChild(t)}};static InsideBoard=e=>!(e[0]<0||e[0]>6||e[1]<0||e[1]>6||e[0]<2&&e[1]<2||e[0]<2&&e[1]>4||e[0]>4&&e[1]<2||e[0]>4&&e[1]>4);static IsEmpty=e=>!document.getElementById(""+e[0]+e[1]).hasChildNodes();static Add=(e,t)=>[e[0]+t[0],e[1]+t[1]];static Equal=(e,t)=>e[0]==t[0]&&e[1]==t[1];static GetValidMoves=t=>!e.InsideBoard(t)||e.IsEmpty(t)?[]:[[-2,0],[2,0],[0,-2],[0,2]].reduce(((n,s)=>{const o=e.Add(t,s);return e.InsideBoard(o)&&e.IsEmpty(o)&&n.push(o),n}),[]);static RemovePeg=e=>{let t=document.getElementById(""+e[0]+e[1]);t.firstChild&&t.removeChild(t.firstChild)};static FindBetweenPeg=(e,t)=>e[0]===t[0]&&e[1]<t[1]?[e[0],e[1]+1]:e[0]===t[0]&&e[1]>t[1]?[e[0],e[1]-1]:e[1]===t[1]&&e[0]<t[0]?[e[0]+1,e[1]]:e[1]===t[1]&&e[0]>t[0]?[e[0]-1,e[1]]:void 0;static EmptyPegs=()=>{let t=0;for(let n=0;n<e.boardSize;++n)for(let s=0;s<e.boardSize;++s)e.InsideBoard([n,s])&&e.IsEmpty([n,s])&&t++;return t};UpdateStats=()=>{this.textContainer.textContent=`\n    ${this.nMoves} move(s) done \n\n    Pegs Remaining :  ${33-e.EmptyPegs()}\n    `};MovePeg=(t,n)=>{if(e.GetValidMoves(t).find((t=>e.Equal(t,n)))){e.RemovePeg(n),e.RemovePeg(t),e.RemovePeg(e.FindBetweenPeg(t,n));const s=document.createElement("span");return s.className="movedPeg",document.getElementById(""+n[0]+n[1]).appendChild(s),this.nMoves++,this.UpdateStats(),!0}return console.log("Attempted invalid move ",t,n),console.log("Valid moves were ",e.GetValidMoves(t)),!1};static MovePegForce=(t,n)=>{e.RemovePeg(n),e.RemovePeg(t),e.RemovePeg(e.FindBetweenPeg(t,n));var s=document.createElement("span");s.className="movedPeg",document.getElementById(""+n[0]+n[1]).appendChild(s)};static AllowedMoves=()=>{let t=[];for(let n=0;n<e.boardSize;++n)for(let s=0;s<e.boardSize;++s){const o=[n,s],a=e.GetValidMoves(o);a.length&&a.forEach((n=>{const s=e.FindBetweenPeg(o,n);e.IsEmpty(s)||t.push([o,n])}))}return t};static MoveablePegsActual=()=>{const t=new Set;return e.AllowedMoves().forEach((([e,n])=>{t.add(""+e[0]+e[1])})),Array.from(t,(e=>[Number(e[0]),Number(e[1])]))};RandomMove=()=>{let t=e.AllowedMoves();if(!t.length)return;let n=t[Math.floor(Math.random()*t.length)];this.MovePeg(n[0],n[1])};static ClearCells=()=>{for(let t=0;t<e.boardSize;++t)for(let n=0;n<e.boardSize;++n)document.getElementById(""+t+n).className="cell"};ClearListeners=()=>{for(let t=0;t<e.boardSize;++t)for(let n=0;n<e.boardSize;++n){const e=document.getElementById(""+t+n).firstChild;e&&"movedPeg"===e.className&&(e.className="peg")}this.board.innerHTML=this.board.innerHTML};UpdateReport=()=>{this.textContainer.textContent=`\n    Report\n    Strategy : Greedy with Random Moves\n    Number of Experiments : ${this.nExperiments}\n    Average Moves per experiment : ${this.avgMoves/this.nExperiments}\n    Average No of Pegs remaining : ${this.avgPegsRemaining/this.nExperiments}\n    `};UpdateDfsReport=(e,t)=>{this.textContainer.textContent=`\n    Report\n    Strategy : DFS\n    Number of states explored : ${e}\n    Time taken : ${t} ms\n    `};static sleep=e=>new Promise((t=>setTimeout(t,e)));ResetBoard=()=>{this.nMoves=0,this.board.replaceChildren(),e.InitializeBoard()};RunRandomGame=async()=>{for(let t=0;t<this.lifeTime&&e.AllowedMoves().length;t++)this.RandomMove(),await e.sleep(this.sleepTime)};static updateStatusWithDot(e){document.getElementById("status").textContent=e;const t=document.getElementById("statusDot"),n=e.toLowerCase();n.includes("idle")?t.style.backgroundColor="green":n.includes("running")||n.includes("exploring")?t.style.backgroundColor="red":t.style.backgroundColor="blue"}RunExperiment=async t=>{this.FullReset(),e.updateStatusWithDot("Random Agent : Running"),document.getElementById("randomBtn").style.display="none",document.getElementById("dfsBtn").style.display="none",document.getElementById("manualBtn").style.display="none",this.nExperiments=t,this.avgMoves=0,this.avgPegsRemaining=0;for(let t=0;t<this.nExperiments;++t)this.ResetBoard(),await this.RunRandomGame(),this.avgMoves+=this.nMoves,this.avgPegsRemaining+=33-e.EmptyPegs();this.UpdateReport(),e.updateStatusWithDot("Idle")};static GetBoardState=()=>{let t="";for(let n=0;n<e.boardSize;++n)for(let s=0;s<e.boardSize;++s)e.InsideBoard([n,s])&&(t+=e.IsEmpty([n,s])?"0":"1");return t};SetBoardState=t=>{this.board.replaceChildren();for(let t=0;t<e.boardSize;++t){var n=document.createElement("div");n.setAttribute("id","rowID"),n.className="row";for(let o=0;o<e.boardSize;++o){var s=document.createElement("div");s.setAttribute("id",""+t+o),s.className="cell",n.appendChild(s)}this.board.appendChild(n)}let o=0;for(let n=0;n<e.boardSize;++n)for(let s=0;s<e.boardSize;++s)if(e.InsideBoard([n,s])){if("1"==t[o]){var a=document.createElement("span");a.className="peg",document.getElementById(""+n+s).appendChild(a)}o++}};PrepareSourceInput=()=>{this.ClearListeners();const t=new AbortController;let n=e.AllowedMoves().length;n?(this.textContainer.textContent=`\n    ${this.userMoves} moves done\n    ${n} legal moves can be performed \n    `,e.MoveablePegsActual().forEach((n=>{const s=document.getElementById(""+n[0]+n[1]).firstChild;s.className="moveablePeg",s.draggable=!0,s.addEventListener("mouseover",(()=>{s.click()})),s.addEventListener("touchstart",(e=>{e.preventDefault(),s.click()})),s.addEventListener("click",(()=>{s.className="selectedPeg",this.sourcePeg=[n[0],n[1]],e.MoveablePegsActual().forEach((t=>{e.Equal(n,t)||(document.getElementById(""+t[0]+t[1]).firstChild.className="peg")})),t.abort(),this.PrepareDestinationInput()}))}))):(32==e.EmptyPegs()?(this.textContainer.textContent=` \n      Completed Successfully ! \n\n      ${this.userMoves} move(s) done\n      `,document.getElementById("celebrations").style.display=""):this.textContainer.textContent=` \n        Finished\n        ${this.userMoves} move(s) done \n\n        Pegs Remaining :  ${33-e.EmptyPegs()}\n        `,document.getElementById("undoBtn").style.display="none",e.updateStatusWithDot("Idle"),this.boardHistory=[],this.boardHistory.push(e.defaultStartingState))};PrepareDestinationInput=()=>{this.ClearListeners();const t=new AbortController;let n=e.AllowedMoves(),s=new Set;n.forEach((([t,n])=>{e.Equal(this.sourcePeg,t)&&s.add(""+n[0]+n[1])})),s.forEach((n=>{const s=document.getElementById(""+n[0]+n[1]);s.addEventListener("click",(()=>{e.RemovePeg(this.sourcePeg),e.RemovePeg([Number(n[0]),Number(n[1])]),e.RemovePeg(e.FindBetweenPeg(this.sourcePeg,[Number(n[0]),Number(n[1])])),e.ClearCells();var o=document.createElement("span");o.className="movedPeg",s.appendChild(o),this.userMoves++,this.boardHistory.push(e.GetBoardState()),t.abort(),this.PrepareSourceInput()})),s.addEventListener("dragover",(e=>{e.preventDefault()}),{passive:!1}),s.addEventListener("drop",(o=>{o.preventDefault(),e.RemovePeg(this.sourcePeg),e.RemovePeg([Number(n[0]),Number(n[1])]),e.RemovePeg(e.FindBetweenPeg(this.sourcePeg,[Number(n[0]),Number(n[1])])),e.ClearCells();var a=document.createElement("span");a.className="movedPeg",s.appendChild(a),this.userMoves++,this.boardHistory.push(e.GetBoardState()),t.abort(),this.PrepareSourceInput()}),{signal:t.signal}),s.className="allowedCell"}));let o=document.getElementById(""+this.sourcePeg[0]+this.sourcePeg[1]);o.addEventListener("mouseout",(()=>{e.ClearCells(),t.abort(),this.PrepareSourceInput()})),o.addEventListener("touchstart",(n=>{n.preventDefault(),e.ClearCells(),t.abort(),this.PrepareSourceInput()})),o.addEventListener("drag",(e=>{e.target.classList.add("dragging")})),o.addEventListener("dragend",(e=>{e.target.classList.remove("dragging")}))};UndoMove=()=>{this.boardHistory.length>1&&(this.SetBoardState(this.boardHistory.at(-2)),this.boardHistory.pop(),this.userMoves--,this.PrepareSourceInput())};ManualMode=()=>{this.FullReset(),e.updateStatusWithDot("Manual Mode"),document.getElementById("undoBtn").style.display="unset",document.getElementById("randomBtn").style.display="none",document.getElementById("dfsBtn").style.display="none",document.getElementById("manualBtn").style.display="none",this.PrepareSourceInput()};FullReset=()=>{"Idle"===document.getElementById("status").textContent||"Manual Mode"===document.getElementById("status").textContent?(this.sourcePeg=[-1,-1],this.userMoves=0,this.ResetBoard(),this.textContainer.textContent="\n  Welcome to Peg Solitaire ! \n\n  Click on the buttons below to start\n    ",e.updateStatusWithDot("Idle"),document.getElementById("undoBtn").style.display="none",document.getElementById("randomBtn").style.display="unset",document.getElementById("dfsBtn").style.display="unset",document.getElementById("manualBtn").style.display="unset",this.boardHistory=[],this.boardHistory.push(e.defaultStartingState)):window.location.reload()}}class t{constructor(e){this.pegSolitaireBoardInstance=e,this.visited=[],this.memoryMap=new Map,this.execTime=0,this.cellMapping=new Map,this.MakeMap()}MakeMap=()=>{let t=-1;for(let n=0;n<7;n++)for(let s=0;s<7;s++)e.InsideBoard([n,s])&&(++t,this.cellMapping.set(""+n+s,t))};dfs(t){const n=[{board:t,steps:0}];for(;n.length>0;){const{board:t,steps:s}=n.pop();if(this.pegSolitaireBoardInstance.SetBoardState(t),33-e.EmptyPegs()==1)return!0;this.visited.includes(t)||this.visited.push(t),e.AllowedMoves().forEach((([o,a])=>{this.pegSolitaireBoardInstance.SetBoardState(t),this.pegSolitaireBoardInstance.MovePeg(o,a);let d=e.GetBoardState();this.memoryMap.set(d,t),this.visited.includes(d)||n.push({board:d,steps:s+1})}))}return!1}findSolution(){let t=performance.now();const n=this.dfs(e.defaultStartingState);this.execTime=performance.now()-t,n||console.log("No solution found.")}reconstructPath(){let t=[e.finalState],n=this.memoryMap.get(e.finalState);for(;n;)t.push(n),n=this.memoryMap.get(n);return t.reverse()}findMove=(e,t)=>{const n=e.split("").map(Number),s=t.split("").map(Number);let o=n.reduce(((e,t,n)=>(t!==s[n]&&e.push(n),e)),[]).map((e=>[...this.cellMapping].find((([t,n])=>e===n))[0])),a=o.find((e=>0===n[this.cellMapping.get(e)]));return[o[0]===a?[Number(o[2][0]),Number(o[2][1])]:[Number(o[0][0]),Number(o[0][1])],[Number(a[0]),Number(a[1])]]};displayDfsSolution=async()=>{this.pegSolitaireBoardInstance.UpdateDfsReport(this.visited.length,this.execTime),this.pegSolitaireBoardInstance.ResetBoard();let t=this.reconstructPath();e.updateStatusWithDot("DFS : Displaying"),await e.sleep(2e3);for(let n=1;n<t.length;++n){let s=this.findMove(t[n-1],t[n]);e.MovePegForce(s[0],s[1]),await e.sleep(1e3)}e.updateStatusWithDot("Idle")};static validMoveChecker=(e,t)=>e[0]===t[0]&&2===Math.abs(e[1]-t[1])||e[1]===t[1]&&2===Math.abs(e[0]-t[0])||(console.log("Invalid move found : ",e,t),!1)}var n=0;function s(){n=0;const e=document.getElementById("commandPalette");e.style.display="block"===e.style.display?"none":"block"}const o=new e;(new class{constructor(){this.starsId="starsCSS",this.wavesId="wavesCSS"}initThemeSwitch(){const{matches:e}=window.matchMedia("(prefers-color-scheme: dark)");let t=localStorage.getItem("theme")?localStorage.getItem("theme"):e?"dark":"light";document.body.className="dark"===t?"dark-mode":"",localStorage.setItem("theme",t),this.handleThemeCSSLoading(t);const n=document.getElementById("toggleInputID");n.checked="dark"===t,n.addEventListener("change",(e=>{const t=e.target.checked?"dark":"light";document.body.className="dark"===t?"dark-mode":"",localStorage.setItem("theme",t),this.handleThemeCSSLoading(t)}))}loadStars(){if(!document.getElementById(this.starsId)){const e=document.getElementsByTagName("head")[0],t=document.createElement("link");t.id=this.starsId,t.rel="stylesheet",t.type="text/css",t.href="stars.css",t.media="all",e.appendChild(t)}}removeStars(){document.getElementById(this.starsId)?.remove()}loadWaves(){if(!document.getElementById(this.wavesId)){const e=document.getElementsByTagName("head")[0],t=document.createElement("link");t.id=this.wavesId,t.rel="stylesheet",t.type="text/css",t.href="waves.css",t.media="all",e.appendChild(t)}}removeWaves(){document.getElementById(this.wavesId)?.remove()}handleThemeCSSLoading(e){"dark"===e?(this.removeWaves(),this.loadStars()):(this.removeStars(),this.loadWaves())}}).initThemeSwitch(),n=0,document.addEventListener("keydown",(function(e){const t=document.getElementById("commandPalette");"Escape"===e.key?t.style.display="none":"p"===e.key&&s()})),document.addEventListener("click",(function(e){const t=document.getElementById("commandPalette");e.target===t||t.contains(e.target)||(t.style.display="none")})),document.addEventListener("keydown",(function(e){if("block"===document.getElementById("commandPalette").style.display){const t=document.querySelectorAll(".command");"ArrowUp"===e.key&&n>0?n--:"ArrowDown"===e.key&&n<t.length-1&&n++,t.forEach(((e,t)=>{t===n?e.classList.add("selected"):e.classList.remove("selected")})),"Enter"===e.key&&t[n].click()}})),document.getElementById("switchTheme").onclick=function(){s(),document.getElementById("toggleInputID").checked=!document.getElementById("toggleInputID").checked,document.getElementById("toggleInputID").dispatchEvent(new Event("change"))};const a=()=>{o.ResetBoard(),e.updateStatusWithDot("DFS : Exploring"),document.getElementById("randomBtn").style.display="none",document.getElementById("dfsBtn").style.display="none",document.getElementById("manualBtn").style.display="none",document.getElementById("textContainerID").textContent="Exploring...",requestAnimationFrame((()=>{requestAnimationFrame((()=>{const e=new t(o);e.findSolution(),e.displayDfsSolution()}))}))},d=(e,t)=>{document.getElementById(e).onclick=()=>{s(),t()}};d("manualBtn",o.ManualMode),d("randomBtn",(()=>o.RunExperiment(1))),d("dfsBtn",a),d("resetBtn",(()=>o.FullReset())),d("undoBtn",(()=>o.UndoMove())),document.getElementById("undoBtn").style.display="none",d("startRandomAgent",(()=>o.RunExperiment(1))),d("start5RandomAgents",(()=>o.RunExperiment(5))),d("startManualMode",o.ManualMode),d("startDFS",a),d("undoMove",(()=>o.UndoMove())),d("fullReset",(()=>o.FullReset()))})();